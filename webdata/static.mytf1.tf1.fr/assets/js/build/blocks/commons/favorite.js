define([],function(){"use strict";function t(t){if(n=t,e=[].slice.call(n.querySelectorAll(".btn_favorite_wrapper")),i=[].slice.call(n.querySelectorAll(".btn_favorite")),a=[].slice.call(n.querySelectorAll(".btn_follow")),r=document.getElementById("favCount"),"undefined"!=typeof oas_device)switch(oas_device){case"web":l="responsive_desktop";break;case"mobile":l="responsive_smartphone";break;case"tablette":l="responsive_tablette"}return class_userlib.isAuthenticated()&&(sessionStorage.getItem("temporary_favorite")&&this.addTemporaryFavorite(),this.updateUserFavorite()),this.initFavorite(),this}var e=[],i=[],a=[],o={videos:[],programs:[]},s=[],n=!1,r=!1,l="responsive_desktop";return t.prototype.addBtnClickEvents=function(t){t.addEventListener("click",function(e){e.stopPropagation();var i=t.getAttribute("data-id"),a=t.getAttribute("data-type");this.favoriteAlreadyAdded(a,i)?this.removeFavorite(a,i,t):this.addFavorite(a,i,t)}.bind(this))},t.prototype.addFavorite=function(t,e,i){i&&utils.addClass(i,"loading"),utils.ajax(envConfig.apiUrl+"favorites/"+t,{method:"POST",withCredentials:!0,data:{id:e},success:function(){i&&utils.addClass(i,"loading"),this.updateUserFavorite()}.bind(this)})},t.prototype.addPopinEvents=function(t){t.addEventListener("click",function(e){e.stopPropagation();var i=t.getElementsByClassName("btn_favorite")[0];t.getElementsByClassName("js_label")[0],i.getAttribute("data-id");utils.hasClass(t,"visible")?utils.removeClass(t,"visible"):utils.addClass(t,"visible")})},t.prototype.addTemporaryFavorite=function(){var t=JSON.parse(sessionStorage.getItem("temporary_favorite")),e=t.id,i=t.type;this.addFavorite(i,e),sessionStorage.removeItem("temporary_favorite")},t.prototype.closeAllBtns=function(){[].forEach.call(document.querySelectorAll(".btn_favorite_wrapper.visible"),function(t){utils.removeClass(t,"visible")})},t.prototype.initFavorite=function(){i.concat(a).forEach(function(t){this.addBtnClickEvents(t)}.bind(this)),e.forEach(function(t){this.addPopinEvents(t)}.bind(this)),document.body.addEventListener("click",this.closeAllBtns),document.body.addEventListener("touchend",this.closeAllBtns)},t.prototype.updateCount=function(){o.videos.length>0&&utils.addClass(r,"active")},t.prototype.updateHistory=function(){null!==class_userlib.getCookie("isAuthenticated")&&""!==class_userlib.getCookie("isAuthenticated")&&s.forEach(function(t){for(var e=n.querySelectorAll('[data-id="'+t.id+'"]'),i=e.length,a=0;i>a;a++){var o=e[a],s=o.getElementsByClassName("loadingbar")[0],r=o.getElementsByClassName("loadingbar_elt")[0];if(s&&(s.style.display="block",r&&(r.style.width=100*t.percent+"%"),t.percent<1)){var l=o.getElementsByClassName("msg_play")[0];l&&(l.innerHTML="Reprendre")}}})},t.prototype.updateLabels=function(){i.concat(a).forEach(function(t){var e=t.getElementsByClassName("js_label")[0],i=t.getAttribute("data-id"),a=t.getAttribute("data-type");utils.removeClass(t,"loading"),-1!==o[a].indexOf(i)?(utils.addClass(t,"on"),e.innerHTML=t.getAttribute("data-text-on")):(utils.removeClass(t,"on"),e.innerHTML=t.getAttribute("data-text-off"))}.bind(this))},t.prototype.updateUserFavorite=function(){null!==class_userlib.getCookie("isAuthenticated")&&""!==class_userlib.getCookie("isAuthenticated")&&utils.ajax(envConfig.apiUrl+"profile",{method:"GET",withCredentials:!0,success:function(t){o=t.favorites,o&&(this.updateLabels(),this.updateCount()),s=t.history,s&&this.updateHistory()}.bind(this)})},t.prototype.removeFavorite=function(t,e,i){utils.addClass(i,"loading"),utils.ajax(envConfig.apiUrl+"favorites/"+t+"/"+e,{method:"DELETE",withCredentials:!0,data:{},success:function(){utils.addClass(i,"loading"),document.getElementById("myFavorites")&&(window.location=window.location),this.updateUserFavorite()}.bind(this)})},t.prototype.favoriteAlreadyAdded=function(t,e){if(class_userlib.isAuthenticated())return-1!==o[t].indexOf(e)?!0:!1;var i=document.body.getAttribute("data-channel")||!1,a=document.body.getAttribute("data-program")||!1;sessionStorage.setItem("temporary_favorite",'{"id":"'+e+'", "type":"'+t+'"}');var s="/connecting?redirectUri="+encodeURIComponent(window.location.href)+"&device="+l+"&accessId=favoris";i&&(s+="&channel="+i),a&&(s+="&program="+a),window.location=s},t});