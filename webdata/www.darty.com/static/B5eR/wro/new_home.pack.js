
var DARTY_CONF=DARTY_CONF||{};(function($){DARTY_CONF.triggerHorizontalSlider=function(){var displayElem=function(trigger){var index=trigger.parent("tr").children().index(trigger);var cont=$("#home_carrousel_group div.line_"+index);trigger.addClass("displayed").siblings().removeClass("displayed");cont.show().siblings("div.line").hide();};var commander=DARTY_CONF.startDisplayLoop($("#home_carrousel_tabs"),10000,displayElem,"td");DARTY_CONF.customCallback=function(){if($("#home_carrousel_tabs .recsRR").is(":visible")){commander.updateIndex(0);}};};DARTY_CONF.displayPreHome=function(){if(DARTY_CONF.getCookie(DARTY_CONF.PREHOME_FLAG_COOKIE,true)!==null){return;}
if(DARTY_CONF.CONST.CCD_USER){return;}
var trigger=$("#prehome_container");var PREHOME_COOKIE="DARTY_COM_PREHOME_COOKIE",imageLoaded=false,popinLoaded=false,hasPrehomeCookie=function(code){var c=DARTY_CONF.getCookie(PREHOME_COOKIE,true);return c!==null&&c==code;},setPrehomeCookie=function(code,isUnique){var days=isUnique?365:null;DARTY_CONF.setCookie(PREHOME_COOKIE,code,days,"darty.com");},triggerHide=function(){if(imageLoaded&&popinLoaded){trigger.delay(trigger.attr("data-delay")*1000).queue(function(){trigger.hide();trigger.overlay().close();});}};if(trigger.length===0){return;}
var code=trigger.attr("data-code");var alreadyDisplayed=hasPrehomeCookie(code);if(alreadyDisplayed){return;}
trigger.detach().appendTo("body");var image=$("<img src='"+trigger.attr("data-image")+"' width='800' height='500' />");image.load(function(){imageLoaded=true;triggerHide();});trigger.find("a").append(image);var isUnique=trigger.attr("data-display-once")!="false";setPrehomeCookie(code,isUnique);trigger.overlay({close:"#trigger_close_adv_fullscreen",onLoad:function(){popinLoaded=true;triggerHide();},onBeforeClose:function(){trigger.hide();},load:true,left:'center',top:'center',mask:{color:'#FFF',loadSpeed:'fast',opacity:0.775},closeOnClick:false,fixed:!DARTY_CONF.IE6});};DARTY_CONF.displayAppstoreDownload=function(){var trigger=$("#appstoredownload_container");var APPSTOREDOWNLOAD_COOKIE="DARTY_COM_APPSTOREDOWNLOAD_COOKIE",popinLoaded=false,hasAppstoreDownloadCookie=function(){var c=DARTY_CONF.getCookie(APPSTOREDOWNLOAD_COOKIE,true);return c!==null;};setAppstoreDownloadCookie=function(){DARTY_CONF.setCookie(APPSTOREDOWNLOAD_COOKIE,null,397,"darty.com");};setCloseButton=function(){trigger.find('#closebutton').bind('click',function(){if(trigger.find('#hidemenexttime').is(':checked')){setAppstoreDownloadCookie();}});};setDownloadUrl=function(){var url='#';if(DARTY_CONF.APPLICATIONS){if(DARTY_CONF.UA_APPLE){var url=DARTY_CONF.APPLICATIONS.apple;}
if(DARTY_CONF.UA_ANDROID){var url=DARTY_CONF.APPLICATIONS.android;}
if(DARTY_CONF.UA_WINDOWS){var url=DARTY_CONF.APPLICATIONS.windows;}}
trigger.find('#button').attr('href',url);};if(trigger.length===0){return;}
var alreadyDisplayed=hasAppstoreDownloadCookie();if(alreadyDisplayed){return;}
$("body").prepend(trigger.detach());setCloseButton();setDownloadUrl();if(trigger.find("#button").attr("href")=='#'){return;}
trigger.overlay({close:"#closebutton",onBeforeLoad:function(){$('html').data('old-overflow',$('html').css('overflow'));$('html').css('overflow','hidden');},onLoad:function(){popinLoaded=true;},onBeforeClose:function(){trigger.hide();$('html').css('overflow',$('html').data('old-overflow'));},load:true,left:'center',top:'center',mask:{color:'#FFF',loadSpeed:'fast',opacity:0.775},closeOnClick:false,fixed:!DARTY_CONF.IE6});};$(function(){DARTY_CONF.triggerHorizontalSlider();if(DARTY_CONF.TABLET&&!DARTY_CONF.CONST.B2B_VERSION){DARTY_CONF.displayAppstoreDownload();}else{DARTY_CONF.displayPreHome();}
DARTY_CONF.displayChezVousLe();});})(jQuery);

(function($){function displayGeolocalisedSlider(){var geoloc_content=$(".cont_vertslideShw .js_geoloc");var geoloc_title=$("#carousel_image_product_tab .js_geoloc");if(geoloc_content!==undefined&&geoloc_content.length!==0){$.ajax({type:'GET',dataType:'html',url:DARTY_CONF.CONST.CTX_PATH+"nav/extra/ajax/geolocalisation"+getParameter(),cache:true,success:function(data){if(data&&data!==undefined){geoloc_content.html(data);geoloc_title.html("D&eacute;stockage");}}});}};function getParameter(){if(window.location.href.indexOf('?')!==-1){return window.location.href.slice(window.location.href.indexOf('?'));}
return"";}
function displayGeolocalisedHome(){function updateSlider(slider){if(typeof slider.position==="undefined"){return;}
if((typeof slider.title!=="undefined")&&(typeof slider.url!=="undefined")){var content=$("#a_0");if(content.hasClass("product")){content.find(".product_flags").remove();content.find(".product_panel").remove();content.find(".product_img").remove();content.append("<a><img/></a>");}
var link=typeof slider.link==="undefined"?"#":slider.link;var a=$(content).find("a");a.attr("href",link);var target=typeof slider.newWindow!=="undefined"&&slider.newWindow?"_blank":"";a.attr("target",target);var img=$(content).find("img");img.attr("src",slider.url);if(typeof slider.alt!=="undefined"){$(content).find("img").attr("alt",slider.alt);}
var $elements=$("#carousel_image_product_tab").children();var length=$elements.length;if(length<6){var lastElement=$elements.get(length-1);$(lastElement).clone(true).appendTo("#carousel_image_product_tab");}
var text='';for(var i=length-1;i>0;i--){text=$($elements.get(i-1)).children("a").text()
$($elements.get(i)).children("a").text(text)}
$($elements.get(0)).children("a").text(slider.title)
var dataCurrentIndex=$("#carousel_image_product_tab").attr("data-current-index");if(dataCurrentIndex==0){$(content).addClass("displayed");$("#a_1").removeClass("displayed");}
DARTY_CONF.carouselImageProductOffset=0
DARTY_CONF.triggerCarouselImageProduct()}}
function updateBackground(background){if(typeof background.url!=="undefined"){$("body").css("background-image","url('"+background.url+"')");}}
function updateBottomRight(bottomRight){if(typeof bottomRight.title!=="undefined"){$("#blockright .blocktitle span").html(bottomRight.title);}
if(typeof bottomRight.url!=="undefined"){var img=$("#blockright .image_link img");img.attr("src",bottomRight.url);if(typeof bottomRight.alt!=="undefined"){img.attr("alt",bottomRight.alt);}
var link=typeof bottomRight.link==="undefined"?"#":bottomRight.link;var a=$("#blockright .image_link a");a.attr("href",link);var target=typeof bottomRight.newWindow!=="undefined"&&bottomRight.newWindow?"_blank":"";a.attr("target",target);}}
var url=DARTY_CONF.CONST.CTX_PATH+"nav/extra/ajax/geolocalisedhome"+getParameter();$.getJSON(url,function success(data){if(typeof data!=="undefined"&&data!=null&&typeof data.background!=="undefined"){updateSlider(data.slider);updateBackground(data.background);updateBottomRight(data.bottomRight);}});}
$(function(){displayGeolocalisedSlider();displayGeolocalisedHome();});})(jQuery);

(function($){DARTY_CONF.ref_g=$('body').hasClass('ref_g');DARTY_CONF.openAvailRelatedPopup=function(url,width,height){var fullUrl=DARTY_CONF.CONST.DARTY_COM_BASEURL||'';fullUrl+=url;if(typeof DARTY_CONF.availRelatedPopup==="object"&&typeof DARTY_CONF.availRelatedPopup.close==="function"){DARTY_CONF.availRelatedPopup.close();}
DARTY_CONF.availRelatedPopup=window.open(fullUrl,"","width="+width+",height="+height+",toolbar,scrollbars=yes,resizable=yes");DARTY_CONF.availRelatedPopup.focus();};function getOverlayPopin(closeClass){var popin=$("#product_dcom_availability_overlay_popin");if(popin.length>0){popin.empty();popin.removeClass();if(DARTY_CONF.ref_g){popin.addClass('modal');}else{popin.addClass('popin_container');}}else{if(DARTY_CONF.ref_g){$("body").append('<div id="product_dcom_availability_overlay_popin" class="modal"></div>');}else{$("body").append('<div id="product_dcom_availability_overlay_popin" class="popin_container"></div>');}
popin=$("#product_dcom_availability_overlay_popin");}
if(typeof closeClass==="undefined"){closeClass="darty_red_cross";}
if(DARTY_CONF.ref_g){popin.css('height','500px');}else{popin.append("<span class='sprite close "+closeClass+"'></span>");}
return popin;}
DARTY_CONF.openPopinDispo=function(e,trigger){if(e)
e.stopPropagation();var url=DARTY_CONF.CONST.DARTY_COM_BASEURL;url+="/webapp/wcs/stores/servlet/DartyDeliverySelectorView?storeId=10001&extd=1";url+="&codic="+trigger.attr("data-codic");var insee=trigger.attr("data-insee");if(typeof insee!=="undefined"){url+="&inseeCode="+insee;}
var zipCode=trigger.attr("data-zipcode");if(typeof zipCode!=="undefined"){url+="&zipCode="+zipCode;}
var city=trigger.attr("data-city");if(typeof city!=="undefined"){url+="&ville="+escape(city);}
var popin=getOverlayPopin();if(DARTY_CONF.ref_g){popin.css("width","520px");popin.css("height","520px");popin.removeClass("modal");popin.addClass("product_dcom_availability_overlay_popin popin_container");}else{popin.css("width","500px");popin.css("height","535px");popin.css("overflow","hidden");popin.addClass("product_dcom_availability_overlay_popin");}
DARTY_CONF.displayCenteredPopin(trigger,popin,function(){if(DARTY_CONF.ref_g){popin.append('<span class="close_availability_popin_button darty_red_cross sprite close"></span>');popin.append('<iframe src="'+url+'" width="100%" height="520px"></iframe>');}else{popin.append("<iframe src='"+url+"' width='500px' height='535px'></iframe>");}});}
DARTY_CONF.triggerDcomAvailPopinDisplays=function(context){if(context===undefined){context=$("body");}
var bindMoreInfosLinks=function(cont){cont.find(".more_infos_click_and_collect_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_retrait_en_magasin/index.html',818,639);});cont.find(".more_infos_livraison_darty_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_darty/index.html',660,349);});cont.find(".more_infos_livraison_colissimo_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_colissimo/index.html',657,400);});cont.find(".more_infos_livraison_ups_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_ups/index.html',657,400);});cont.find(".more_infos_livraison_chronopost_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_chronopost/index.html',657,400);});cont.find(".more_infos_livraison_kiala_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_kiala/kiala.html',657,400);});cont.find(".more_infos_livraison_chronorelais_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_chronorelais/index.html',657,400);});cont.find(".more_infos_livraison_mkp_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_marketplace/index.html',657,400);});cont.find(".more_infos_livraison_relais_mon_commercant_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_livraison_relais_mon_commercant/index.html',657,400);});},bindKiala=function(cont){var trigger=cont.find(".livraison_kiala_view_map_trigger");trigger.click(function(e){e.stopPropagation();var url="https://locateandselect.kiala.com/search";url+="?dspid=33600281";url+="&language=fr";url+="&countryid=fr";url+="&css="+DARTY_CONF.CONST.DARTY_COM_BASEURL;url+="/webapp/wcs/stores/controller/DartyHeaderCssView?file=views/basket/livraison/css/kiala.css";if(DARTY_CONF.TABLET){url+="&gui=sleek";}
var popin=getOverlayPopin("white_close");popin.css("width","850px");popin.css("height","600px");popin.addClass("product_dcom_availability_overlay_popin");DARTY_CONF.displayCenteredPopin(trigger,popin,function(){popin.append("<iframe src='"+url+"' width='850px' height='600px'></iframe>");});});},bindChronoRelais=function(cont){var trigger=cont.find(".livraison_chronorelais_view_map_trigger");trigger.click(function(e){e.stopPropagation();var url=DARTY_CONF.CONST.DARTY_COM_BASEURL+"/webapp/wcs/stores/servlet/DartyDeliveryRelaisChronopostChoice?fromCatalogueSearch=1&storeId=10001";var popin=getOverlayPopin("darty_red_cross");popin.css("width","850px");popin.css("height","680px");if(DARTY_CONF.ref_g){popin.removeClass('modal').addClass("product_dcom_availability_overlay_popin popin_container");}else{popin.addClass("product_dcom_availability_overlay_popin");}
DARTY_CONF.displayCenteredPopin(trigger,popin,function(){popin.append('<span class="close darty_red_cross"></span>');popin.append("<iframe src='"+url+"' width='850px' height='680px'></iframe>");});});},bindRelaisMonCommercant=function(cont){var trigger=cont.find(".livraison_relais_mon_commercant_view_map_trigger");trigger.click(function(e){e.stopPropagation();var url=DARTY_CONF.CONST.DARTY_COM_BASEURL+"/nav/extra/popup/choix_relais_mon_commercant?fromCatalogueSearch=1";var popin=getOverlayPopin("darty_red_cross");popin.css("width","850px");popin.css("height","680px");if(DARTY_CONF.ref_g){popin.removeClass('modal').addClass("product_dcom_availability_overlay_popin popin_container");}else{popin.addClass("product_dcom_availability_overlay_popin");}
DARTY_CONF.displayCenteredPopin(trigger,popin,function(){popin.append('<span class="close darty_red_cross"></span>');popin.append("<iframe src='"+url+"' width='850px' height='680px'></iframe>");});});},bindDisplayDeliveryCalendar=function(cont){var trigger=cont.find(".display_product_delivery_calendar_trigger");trigger.click(function(e){DARTY_CONF.openPopinDispo(e,trigger);});},bindSearchStores=function(cont){var storesTrigger=cont.find(".search_product_in_store_trigger");if(storesTrigger.length>0){storesTrigger.click(function(){getOverlayPopin().hide();});DARTY_CONF.triggerLogisticInStoreFilters(storesTrigger);}},bindDisplayStoreMap=function(cont){var trigger=cont.find("div.display_store_map_trigger");trigger.click(function(){var store=trigger.attr("data-store");DARTY_CONF.openAvailRelatedPopup(DARTY_CONF.CONST.LEADFORMANCE_URL+store,900,510);});},bindAllInPopin=function(trigger,codic){trigger.unbind("click").bind("click",function(){var isMKP=$(this).parent('.mkp_product_availability_cont').length;if(typeof DARTY_CONF.TRACKING!="undefined"){var trackingCont=trigger.parent(".product_availability_cont_trigger").find("span.avail_product_tagging_trigger");}
var popin=getOverlayPopin();if(DARTY_CONF.ref_g){popin.css("width","600px");popin.css("height","500px");}else{popin.css("width","500px");popin.css("height","320px");}
popin.addClass("product_availability_popin");popin.append("<div class='darty_waiting_display'></div>");DARTY_CONF.displayCenteredPopin(trigger,popin);$.get(DARTY_CONF.CONST.CTX_PATH+"nav/extra/ajax/availability?codic="+codic+"&ref_g="+DARTY_CONF.ref_g,function(data){var content=$(data);content.find("span.close_popin_availability_trigger").click(function(){content.hide();});bindMoreInfosLinks(content);bindKiala(content);bindChronoRelais(content);bindRelaisMonCommercant(content);bindDisplayDeliveryCalendar(content);bindSearchStores(content);popin.find(".darty_waiting_display").remove();popin.append(content);});});};$(".display_dcom_avail_popin_trigger",context).each(function(){var trigger=$(this);var codic=trigger.attr("data-codic");bindAllInPopin(trigger,codic);});$("a.immediat_darty",context).each(function(){var trigger=$(this);trigger.click(function(e){e.preventDefault();var url=$(this).attr('href');var popin=getOverlayPopin();popin.css("width","500px");popin.css("height","400px");popin.addClass("product_dcom_availability_overlay_popin modal");DARTY_CONF.displayCenteredPopin(trigger,popin,function(){popin.append('<div class="modal-header"><span>Immédiat Darty</span><span class="close"><span class="icon icon-close pull-right"></span></span></div>');popin.append('<div class="modal-content"><iframe src="'+url+'" width="450px" height="400px"></iframe></div>');});});});if($("#main_products_list").length>0){$("#main_products_list div.sale_availability").each(function(index,value){var cont=$(this);if(cont.find(".dcom_avail_bind_trigger").length>0){bindMoreInfosLinks(cont);bindKiala(cont);bindChronoRelais(cont);bindRelaisMonCommercant(cont);bindDisplayDeliveryCalendar(cont);bindDisplayStoreMap(cont);}});$("#main_products_list .js_store_stock_popin_direct_link").each(function(){var trigger=$(this);DARTY_CONF.triggerLogisticInStoreFilters(trigger);});}
if($("#darty_product_base_info, .page_product .product_body .product_right").length>0){var cont=$("#darty_product_base_info, .page_product .product_body .product_right");bindDisplayDeliveryCalendar(cont,false);var directStoreStockLink=$("#cart .js_store_stock_popin_direct_link");if(directStoreStockLink.length>0){DARTY_CONF.triggerLogisticInStoreFilters(directStoreStockLink);}
$(".product_services").each(function(){var cont=$(this);bindMoreInfosLinks(cont);});}
var slidingBasket=$("#sliding_basket_product_availability");if(slidingBasket.length>0){bindDisplayStoreMap(slidingBasket);bindMoreInfosLinks(slidingBasket);}};DARTY_CONF.triggerLogisticInStoreFilters=function(trigger,validationCallback,startCallback,endCallback){var retrait;var reload=function(cont){var url=DARTY_CONF.CONST.CTX_PATH+"nav/extra/ccstatus";url=addCodic(cont,url);url=addFilter(cont,url);cont.find("select.dcom_store_select").attr("disabled","disabled");cont.find("#block_store_gift").hide();cont.find(".more_infos_click_and_collect_trigger").click(function(){DARTY_CONF.openAvailRelatedPopup('/achat/panier/pop_retrait_en_magasin/index.html',818,639);});$.ajax({url:url,success:function(data){var withCodic=cont.attr("data-codic")!==undefined;if(data.error!==undefined&&data.error!=null&&data.error!==""){$("#in_store_filter_popin_error").html(data.error);}else{$("#in_store_filter_popin_error").empty();if(withCodic){var listCcv1=$("#dcom_in_store_ccv1_list");var listCcv2=$("#dcom_in_store_ccv2_list");listCcv1.empty();listCcv2.empty();if(DARTY_CONF.TABLET){appendInList({value:"",name:"S&eacute;lectionnez votre magasin"},listCcv1);appendInList({value:"",name:"S&eacute;lectionnez votre magasin"},listCcv2);listCcv1[0].selectedIndex=0;listCcv2[0].selectedIndex=0;}
var ccv1Count=0,ccv2Count=0;var proche=0;var dep="";var depStore="";var zipUser=DARTY_CONF.getCookie('USERZIPCODE',true);if(zipUser!==null){dep=zipUser.substring(0,2);}
$.each(data.stores,function(index,value){var list;if(value.status=="CCv1"){ccv1Count++;list=listCcv1;depStore=value.name.substring(value.name.indexOf('(')+1,value.name.indexOf(')'))}else if(value.status=="CCv2"){ccv2Count++;depStore=value.name.substring(value.name.indexOf('(')+1,value.name.indexOf(')'))
list=listCcv2;}
if(dep!==""&&depStore==dep){proche+=1;}
appendInList(value,list);});var ccv1Title="<strong>"+$("#dcom_in_store_ccv1_list_title").attr("data-title")+"</strong>";if(ccv1Count===0){$("#dcom_in_store_ccv1_list_container").addClass("dcom_in_store_no_stores_found");listCcv1.attr("disabled","disabled");}else{ccv1Title+=" ("+ccv1Count+" magasin"+(ccv1Count>1?"s":"")+")";$("#dcom_in_store_ccv1_list_container").removeClass("dcom_in_store_no_stores_found");listCcv1.removeAttr("disabled");}
$("#dcom_in_store_ccv1_list_title").html(ccv1Title);var ccv2Title="<strong>Retrait sous 2/3j</strong>";if(ccv2Count===0){$("#dcom_in_store_ccv2_list_container").addClass("dcom_in_store_no_stores_found");listCcv2.attr("disabled","disabled");}else{ccv2Title+=" ("+ccv2Count+" magasin"+(ccv2Count>1?"s":"")+")";$("#dcom_in_store_ccv2_list_container").removeClass("dcom_in_store_no_stores_found");listCcv2.removeAttr("disabled");}
$("#dcom_in_store_ccv2_list_title").html(ccv2Title);if(cont.find("p.dcom_in_store_introduction").is(":empty")){var productName=cont.attr("data-product-name");var count=ccv1Count+ccv2Count;var intro="Le mod&egrave;le "+productName+" est disponible en retrait dans les magasins list&eacute;s ci-dessous.";intro+="<br />S&eacute;lectionnez un magasin pour voir ses horaires d'ouverture et son plan d'acc&egrave;s";cont.find("p.dcom_in_store_introduction").html(intro);}
triggerValidation("");}else{var list=$("#dcom_in_store_single_list");list.empty();list.removeAttr("disabled");$.each(data.stores,function(index,value){appendInList(value,list);});if(DARTY_CONF.TABLET){list[0].selectedIndex=0;triggerValidation(list.val());}else{triggerValidation("");}
list.on('change',function(){$(this).parents('.modal').find('button[disabled]').attr('disabled',false);})}}
cont.show();cont.find('input').focus();var codic=trigger.attr("data-codic");retrait=ccv1Count+"|"+ccv2Count+"|"+proche;DARTY_CONF.TRACKING.omniture_retraitMag(codic,retrait,"");}});},appendInList=function(value,list){var cccData="";if(value.giftAmount>0){cccData="data-gift-amount='"+value.giftAmount+"' "+"data-gift-tac='"+value.giftCardTermsAndConditions+"'";}
var option=$("<option value='"+value.code+"'  "+cccData+" >"+value.name+"</option>");list.append(option);},addCodic=function(cont,url){var codic=cont.attr("data-codic");return codic!==undefined&&codic!==""?addSeparator(url)+"codic="+codic:url;},addFilter=function(cont,url){var filter=cont.find("#dcom_in_store_search_field").val();return filter!==undefined&&filter!==""?addSeparator(url)+"filter="+filter:url;},addSeparator=function(url){if(url.indexOf("?")==-1){return url+="?";}
else{return url+="&";}},triggerFilters=function(cont){cont.find("#dcom_in_store_search_button").click(function(){reload(cont);});cont.find("#dcom_in_store_search_field").keypress(function(e){if(e.which==13)reload(cont);});cont.find("#dcom_in_store_search_field").click(function(){if($(this).val()!==""&&$(this).val()!=="L"){$(this).val("");reload(cont);}});},triggerValidation=function(store){var showStores=$("#dcom_in_store_show_store_detail");var validate=$("#dcom_in_store_validate");$("#dcom_in_store_show_store_detail").removeAttr("title");$("#dcom_in_store_validate").removeAttr("title");showStores.unbind("click");validate.unbind("click");if(store!==""){showStores.addClass("dcom_in_store_enabled_button");validate.addClass("dcom_in_store_enabled_button");showStores.click(function(){DARTY_CONF.openAvailRelatedPopup(DARTY_CONF.CONST.LEADFORMANCE_URL+store,900,510);});validate.click(function(){if(typeof validationCallback==="function"){validationCallback(store);}});}else{showStores.removeClass("dcom_in_store_enabled_button");validate.removeClass("dcom_in_store_enabled_button");}};trigger.click(function(){if(typeof startCallback==="function"){startCallback();}
var trigger=$(this);var popin=$("#dcom_in_store_logistic_filter_popin");if(DARTY_CONF.ref_g){popin.css("width","560px");popin.css("height","500px");}else{popin.css("width","680px");popin.css("height","500px");}
$("#dcom_in_store_single_list_container ul, #dcom_in_store_two_list_container ul").empty();popin.find("p.dcom_in_store_introduction").empty();var validationButton=popin.find("#dcom_in_store_validate");if(typeof validationCallback==="function"){validationButton.show();}else{validationButton.hide();}
var codic=trigger.attr("data-codic");if(codic===undefined||codic===""){popin.removeAttr("data-codic");popin.removeAttr("data-product-name");var introduction="Pour afficher les mod&egrave;les en retrait dans votre magasin et conna&icirc;tre leur d&eacute;lai "+"de mise &agrave; disposition, choisissez un magasin.";popin.find("p.dcom_in_store_introduction").html(introduction);$("#dcom_in_store_single_list_container").show();$("#dcom_in_store_two_list_container").hide();}else{$("#dcom_in_store_two_list_container").show();$("#dcom_in_store_single_list_container").hide();popin.attr("data-codic",codic);popin.attr("data-product-name",trigger.attr("data-product-name"));popin.find("select.dcom_store_select").empty();$("#dcom_in_store_ccv1_list_title").empty();$("#dcom_in_store_ccv2_list_title").empty();}
popin.find("select.dcom_store_select").unbind("change").bind("change",function(){popin.find("#block_store_gift").hide();var thisSelect=$(this);$.each(popin.find("select.dcom_store_select"),function(){if($(this).attr("id")!==thisSelect.attr("id")){$(this).val([]);}});triggerValidation(thisSelect.val());var omniselect=thisSelect.find("option:selected")[0].text;var omniccado=0;var ccado=thisSelect.find("option:selected").attr('data-gift-amount');if(ccado){var price;omniccado=1;if(DARTY_CONF.PRICE_UTILS.get_float_part(ccado)!=-1){price=DARTY_CONF.PRICE_UTILS.get_int_part(ccado)+","+DARTY_CONF.PRICE_UTILS.get_float_part(ccado);}else{price=DARTY_CONF.PRICE_UTILS.get_int_part(ccado);}
popin.find("#amount_gift").html(price);var popinMoreInfoTrigger=popin.find(".more_infos_gift_trigger");popinMoreInfoTrigger.click(function(){var text=thisSelect.find("option:selected").attr('data-gift-tac');$("#gift_card_termes_text").html(text);$("#gift_card_termes_conditions .gift_card_termes_conditions_close").click(function(){$("#gift_card_termes_conditions").hide();});DARTY_CONF.displayCenteredPopin(popinMoreInfoTrigger,$("#gift_card_termes_conditions"));});popin.find("#block_store_gift").show();}
DARTY_CONF.TRACKING.omniture_retraitMag(codic,retrait,omniselect+"|"+omniccado);});DARTY_CONF.displayCenteredPopin(trigger,popin,function(){triggerFilters(popin);reload(popin);});if(typeof endCallback==="function"){endCallback();}});};DARTY_CONF.triggerLogisticInWarehousesFilters=function(trigger,validationCallback){var triggerValidate=function(cont){cont.find("#in_warehouse_filter_popin_validate_trigger").click(function(){gatherAndCheck(cont);});cont.find("#in_warehouse_filter_popin_input_zipCode").keypress(function(event){if(event.which===13)gatherAndCheck(cont);});},gatherAndCheck=function(cont){var zipCode=cont.find("#in_warehouse_filter_popin_input_zipCode").val();var insee=null;var selectCont=cont.find("#in_warehouse_filter_popin_city_select");if(selectCont.is(":visible")){var selectedCity=selectCont.find("select").find(":selected");if(selectedCity.length>0){insee=selectedCity.val();}}
if(zipCode===undefined||zipCode===""){cont.find("#in_warehouse_filter_popin_error").html("Merci de saisir un code postal.");}else{check(cont,zipCode,insee);}},check=function(cont,zipCode){var url="/nav/extra/warehouses?zipCode="+zipCode;$.ajax({dataType:"json",url:url,cache:true,success:function(data){processResults(cont,data);}});},processResults=function(cont,data){if(data.isValid){validationCallback(data.cities[0].zipCode,data.cities[0].insee);}else if(data.errorMessage!=null&&data.errorMessage!=""){cont.find("#in_warehouse_filter_popin_error").html(data.errorMessage);}else if(data.cities!=null){var citySelect=cont.find("#in_warehouse_filter_popin_city_select select");citySelect.empty();for(var i=0;i<data.cities.length;i++){var city=data.cities[i];citySelect.append($("<option></option>").attr("value",city.insee).attr("zipCode",city.zipCode).attr("reachable",city.isReachable).text(city.name));}
citySelect.change(function(){var sel=$(this).find(":selected");if(sel!==undefined){if(sel.attr("reachable")==="false"){cont.find("#in_warehouse_filter_popin_error").html("Cette ville n'est pas desservie par les livraisons Darty.");}else{validationCallback(sel.attr("zipCode"),sel.val());}}});cont.find("#in_warehouse_filter_popin_city_select").show();}};var isHeterogenousList=trigger.attr("data-mixed-list")==="true";trigger.click(function(){var trigger=$(this);var popin=$("#dcom_in_warehouse_logistic_filter_popin");if(isHeterogenousList){popin.find(".with_hide_trigger").hide();popin.find(".with_mask_trigger").css("visibility","hidden");popin.find(".with_alt_text_trigger").each(function(){$(this).text($(this).attr("data-alt-text"));});}
if(DARTY_CONF.ref_g){popin.css("width","680px");}else{popin.css("width","480px");popin.css("height","250px");}
DARTY_CONF.displayCenteredPopin(trigger,popin,function(){triggerValidate(popin);});popin.find('input[type="text"]').focus();});};$(function(){if(DARTY_CONF.CONST.DCOM_VERSION){DARTY_CONF.triggerDcomAvailPopinDisplays();}});})(jQuery);
