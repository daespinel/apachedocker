!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.DMChromecastSender=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var o=f[q][1][l];return g(o?o:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(i,j,g){function k(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}j.exports=k;k.EventEmitter=k;k.prototype._events=undefined;k.prototype._maxListeners=undefined;k.defaultMaxListeners=10;k.prototype.setMaxListeners=function(m){if(!h(m)||m<0||isNaN(m)){throw TypeError("n must be a positive number")}this._maxListeners=m;return this};k.prototype.emit=function(r){var s,q,m,n,o,p;if(!this._events){this._events={}}if(r==="error"){if(!this._events.error||(e(this._events.error)&&!this._events.error.length)){s=arguments[1];if(s instanceof Error){throw s}throw TypeError('Uncaught, unspecified "error" event.')}}q=this._events[r];if(f(q)){return false}if(l(q)){switch(arguments.length){case 1:q.call(this);break;case 2:q.call(this,arguments[1]);break;case 3:q.call(this,arguments[1],arguments[2]);break;default:m=arguments.length;n=new Array(m-1);for(o=1;o<m;o++){n[o-1]=arguments[o]}q.apply(this,n)}}else{if(e(q)){m=arguments.length;n=new Array(m-1);for(o=1;o<m;o++){n[o-1]=arguments[o]}p=q.slice();m=p.length;for(o=0;o<m;o++){p[o].apply(this,n)}}}return true};k.prototype.addListener=function(o,p){var n;if(!l(p)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",o,l(p.listener)?p.listener:p)}if(!this._events[o]){this._events[o]=p}else{if(e(this._events[o])){this._events[o].push(p)}else{this._events[o]=[this._events[o],p]}}if(e(this._events[o])&&!this._events[o].warned){var n;if(!f(this._maxListeners)){n=this._maxListeners}else{n=k.defaultMaxListeners}if(n&&n>0&&this._events[o].length>n){this._events[o].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[o].length);if(typeof console.trace==="function"){console.trace()}}}return this};k.prototype.on=k.prototype.addListener;k.prototype.once=function(m,o){if(!l(o)){throw TypeError("listener must be a function")}var p=false;function n(){this.removeListener(m,n);if(!p){p=true;o.apply(this,arguments)}}n.listener=o;this.on(m,n);return this};k.prototype.removeListener=function(o,r){var q,m,p,n;if(!l(r)){throw TypeError("listener must be a function")}if(!this._events||!this._events[o]){return this}q=this._events[o];p=q.length;m=-1;if(q===r||(l(q.listener)&&q.listener===r)){delete this._events[o];if(this._events.removeListener){this.emit("removeListener",o,r)}}else{if(e(q)){for(n=p;n-->0;){if(q[n]===r||(q[n].listener&&q[n].listener===r)){m=n;break}}if(m<0){return this}if(q.length===1){q.length=0;delete this._events[o]}else{q.splice(m,1)}if(this._events.removeListener){this.emit("removeListener",o,r)}}}return this};k.prototype.removeAllListeners=function(o){var m,n;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[o]){delete this._events[o]}}return this}if(arguments.length===0){for(m in this._events){if(m==="removeListener"){continue}this.removeAllListeners(m)}this.removeAllListeners("removeListener");this._events={};return this}n=this._events[o];if(l(n)){this.removeListener(o,n)}else{while(n.length){this.removeListener(o,n[n.length-1])}}delete this._events[o];return this};k.prototype.listeners=function(n){var m;if(!this._events||!this._events[n]){m=[]}else{if(l(this._events[n])){m=[this._events[n]]}else{m=this._events[n].slice()}}return m};k.listenerCount=function(o,n){var m;if(!o._events||!o._events[n]){m=0}else{if(l(o._events[n])){m=1}else{m=o._events[n].length}}return m};function l(m){return typeof m==="function"}function h(m){return typeof m==="number"}function e(m){return typeof m==="object"&&m!==null}function f(m){return m===void 0}},{}],2:[function(r,h,F){var e=function(J){return J&&(J["default"]||J)};var H=r("./logger").logger;var t=e(r("./timer"));var z=e(r("./observer"));var I=e(r("./events"));var o="B88B034A";h.exports={initialized:false,session:null,lastPlayerState:null,initializeCastApi:function E(){if(this.initialized){return}this.initialized=true;var K=new chrome.cast.SessionRequest(o);var J=new chrome.cast.ApiConfig(K,this.onSessionCreated.bind(this),this.onReceiverUpdated.bind(this),chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED);chrome.cast.initialize(J,this.onSuccess.bind(this,"Initialization"),this.onError.bind(this))},onSuccess:function k(J){H.log("success:",J)},onError:function l(J){H.error("Error:",J)},onRequestSessionError:function i(J){H.log("Launch error",J);if(J.code!==chrome.cast.ErrorCode.CANCEL){this.stopSession()}else{z.trigger(I.USER_CANCEL,J)}},onMediaError:function v(){H.log("Media error",arguments);this.stopSession()},onSessionCreated:function A(J){this.session=J;H.log("Session ID: "+this.session.sessionId);this.session.removeMediaListener(this.onMediaDiscovered.bind(this,"addMediaListener"));this.session.addMediaListener(this.onMediaDiscovered.bind(this,"addMediaListener"));this.session.removeUpdateListener(this.onSessionUpdate.bind(this));this.session.addUpdateListener(this.onSessionUpdate.bind(this));z.trigger(I.SESSION_AVAILABLE,this.session);if(this.session.media.length!==0){H.log("Found "+this.session.media.length+" media: ["+this.session.media.map(function(K){return K.media.customData})+"]");this.onMediaDiscovered.bind(this,"onSessionCreated",this.session.media[0])()}},onReceiverUpdated:function q(J){if(J===chrome.cast.ReceiverAvailability.AVAILABLE){H.log("Chromecast receiver was found on the network");z.trigger(I.READY)}else{H.log("No Chromecasts available");z.trigger(I.NOT_AVAILABLE)}},onMediaDiscovered:function u(J,K){if(K===this.media){return}this.media=K;H.log("Successfully loaded media ("+J+"): "+this.media.mediaSessionId);this.media.PlayerState=chrome.cast.media.PlayerState;this.info={title:this.media.media.metadata.title,posterUrl:this.media.media.metadata.images[0].url,duration:this.media.media.duration,contentType:this.media.media.contentType,customData:{xid:this.media.media.customData.xid,quality:this.media.media.customData.quality},volume:{volume:this.session.receiver.volume.level,muted:this.session.receiver.volume.muted}};z.trigger(I.MEDIA_DISCOVERED,{mediaSessionId:this.media.mediaSessionId,info:this.info,media:this.media});z.trigger(I.DURATION_CHANGE,{duration:this.info.duration})},onSessionUpdate:function G(J){H.log("onSessionUpdate:",J);if(!J){this.stopSession()}else{this.onVolumeChanged()}},onVolumeChanged:function n(){this.info.volume=this.info.volume||{};var K=this.info.volume.volume;var J=this.info.volume.muted;if(K!==this.session.receiver.volume.level||J!==this.session.receiver.volume.muted){this.info.volume.volume=this.session.receiver.volume.level;this.info.volume.muted=this.session.receiver.volume.muted;z.trigger(I.VOLUME_CHANGED,{volume:this.info.volume.volume,muted:this.info.volume.muted,origin:this.session.receiver.friendlyName})}},onCurrentTimeChanged:function g(){var J=this.media.getEstimatedTime();if(J!==this.info.currentTime){this.info.currentTime=J;z.trigger(I.TIME_UPDATE,{time:J})}},onRequestSessionSuccess:function p(J){this.session=J;H.log("Successfully created session: "+this.session.sessionId);this.onSessionCreated.bind(this,this.session)()},onMediaStatusUpdate:function m(){var J=chrome.cast.media.PlayerState;if(this.lastPlayerState!=null&&this.media.playerState===this.lastPlayerState){return}H.log("MediaStatusUpdate",this.media.playerState);this.lastPlayerState=this.media.playerState;switch(this.media.playerState){case J.PLAYING:t.start(this.onCurrentTimeChanged.bind(this));break;case J.PAUSED:case J.BUFFERING:t.stop();break;case J.IDLE:t.stop();this.lastPlayerState=null;this.media.removeUpdateListener(this.onMediaStatusUpdate.bind(this));break}z.trigger(I.MEDIA_STATUS_UPDATE,this.media.playerState)},requestSession:function f(){var J=arguments[0]===undefined?{}:arguments[0];this.info=J;H.log("Requesting Session with",J);if(!this.session){z.trigger(I.REQUESTING_SESSION)}chrome.cast.requestSession(this.onRequestSessionSuccess.bind(this),this.onRequestSessionError.bind(this))},setVolume:function s(){var K=arguments[0]===undefined?0.5:arguments[0];var J=arguments[1]===undefined?false:arguments[1];if(!this.session){return}if(K!==this.session.receiver.volume.level){this.session.setReceiverVolumeLevel(K,this.onSuccess,this.onError)}if(J!==this.session.receiver.volume.muted){this.session.setReceiverMuted(J,this.onSuccess,this.onError)}},stopSession:function C(){if(this.session!=null&&this.session.status!==chrome.cast.SessionStatus.STOPPED){this.session.stop(this.onSuccess,this.onError)}z.trigger(I.SESSION_STOPPED,this.info);t.stop();this.info=null;this.media=null;this.session=null},loadMedia:function B(L){this.info=L;var J=new chrome.cast.media.MediaInfo(this.info.src,this.info.contentType);J.metadata=new chrome.cast.media.MovieMediaMetadata();J.metadata.metadataType=chrome.cast.media.MetadataType.MOVIE;J.metadata.title=this.info.title;J.metadata.images=[{url:this.info.posterUrl}];J.duration=this.info.duration;J.contentType=this.info.contentType;J.customData=this.info.customData;var K=new chrome.cast.media.LoadRequest(J);K.autoplay=this.info.autoplay;K.currentTime=this.info.currentTime;K.sessionId=this.session.sessionId;this.session.loadMedia(K,this.onMediaDiscovered.bind(this,"loadMedia"),this.onMediaError.bind(this))},watchMediaUpdates:function y(){this.onMediaStatusUpdate();this.media.removeUpdateListener(this.onMediaStatusUpdate.bind(this));this.media.addUpdateListener(this.onMediaStatusUpdate.bind(this))},mediaPlay:function x(){H.log("Play Request");this.media.play(null,this.onSuccess,this.onError)},mediaPause:function w(){H.log("Pause Request");this.media.pause(null,this.onSuccess,this.onError)},mediaSeek:function D(K){H.log("Seek Request");t.stop();var J=new chrome.cast.media.SeekRequest();J.currentTime=K;this.media.seek(J,this.onSuccess,this.onError)},mediaVolume:function j(){var L=arguments[0]===undefined?0.5:arguments[0];var K=arguments[1]===undefined?false:arguments[1];H.log("Volume Request");var J=new chrome.cast.media.VolumeRequest();J.volume=new chrome.cast.Volume(L,K);this.media.setVolume(J,this.onSuccess,this.onError)}}},{"./events":4,"./logger":7,"./observer":8,"./timer":9}],3:[function(g,h,f){h.exports={window:(function(k){var j=function i(){return k.apply(this,arguments)};j.toString=function(){return k.toString()};return j})(function(){return window}),maySupportChromecast:function e(){return/Chrome/.test(this.window().navigator.userAgent)}}},{}],4:[function(f,g,e){g.exports={READY:"chromecast_ready",NOT_AVAILABLE:"chromecast_not_available",SESSION_AVAILABLE:"chromecast_session_available",MEDIA_DISCOVERED:"chromecast_media_discovered",REQUESTING_SESSION:"chromecast_requesting_session",SESSION_STOPPED:"chromecast_session_stopped",MEDIA_STATUS_UPDATE:"chromecast_media_status_update",USER_CANCEL:"chromecast_user_cancel",TIME_UPDATE:"chromecast_time_update",DURATION_CHANGE:"chromecast_duration_changed",VOLUME_CHANGED:"chromecast_volume_changed"}},{}],5:[function(h,f,i){var e=function(q){return q&&(q["default"]||q)};var p=e(h("./events"));var n=e(h("./common"));var m=h("./logger").enableLogs;var o=e(h("./observer"));var l=e(h("./injector"));var g=e(h("./cast"));var k={Events:p,PlayerState:null,debug:m,maySupportChromecast:n.maySupportChromecast.bind(n),injectScript:l,initialize:function j(){return l().then(function(){k.PlayerState=chrome.cast.media.PlayerState;g.initializeCastApi()})},on:o.on.bind(o),off:o.removeListener.bind(o),requestSession:g.requestSession.bind(g),setVolume:g.setVolume.bind(g),loadMedia:g.loadMedia.bind(g),stopSession:g.stopSession.bind(g),watchMediaUpdates:g.watchMediaUpdates.bind(g),mediaPlay:g.mediaPlay.bind(g),mediaPause:g.mediaPause.bind(g),mediaSeek:g.mediaSeek.bind(g),mediaVolume:g.mediaVolume.bind(g)};f.exports=k},{"./cast":2,"./common":3,"./events":4,"./injector":6,"./logger":7,"./observer":8}],6:[function(i,f,j){var e=function(r){return r&&(r["default"]||r)};f.exports=k;var m=e(i("./common"));var p=i("./logger").logger;var q="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js";var l=m.window();var o=l.document;var h=null;function g(s,r){if(typeof l.__onGCastApiAvailable==="function"){return}p.log("defining chromecast cb");l.__onGCastApiAvailable=function(t,u){if(t){p.log("chromecast loaded");s()}else{r(u)}}}function n(){return new Promise(function(t,s){p.log("injecting chromecast script");var r=o.createElement("script");r.onload=r.onreadystatechange=function(){return t()};r.onerror=function(){return s(Error("Error loading script:",q))};r.src=q;o.head.appendChild(r)})}function k(){if(h===null){h=new Promise(function(s,r){if(!m.maySupportChromecast()){r("Not on Google Chrome")}else{g(s,r);n()["catch"](function(t){r(t)})}})}return h}},{"./common":3,"./logger":7}],7:[function(i,j,g){function k(){}var l={log:k,warn:k,info:k,error:k};var f=l;var e=g.enableLogs=function(m){if(m===true||typeof m==="object"){f.log=m.log?m.log.bind(m):console.log.bind(console);f.info=m.info?m.info.bind(m):console.info.bind(console);f.error=m.error?m.error.bind(m):console.error.bind(console);f.warn=m.warn?m.warn.bind(m):console.warn.bind(console);try{f.log()}catch(n){f.log=k;f.info=k;f.error=k;f.warn=k}}else{f=l}};var h=g.logger=f},{}],8:[function(i,j,g){var e=function(m){return Array.isArray(m)?m:Array.from(m)};var k=function(m){return m&&(m["default"]||m)};var l=k(i("events"));var f=new l();f.trigger=function h(o){for(var m=arguments.length,p=Array(m>1?m-1:0),n=1;n<m;n++){p[n-1]=arguments[n]}f.emit.apply(f,[o,o].concat(e(p)))};j.exports=f},{events:1}],9:[function(g,i,e){var f=g("./logger").logger;i.exports={timer:null,start:function j(k){var l=arguments[1]===undefined?500:arguments[1];if(!this.timer){f.log("start timer");this.timer=setInterval(k,l)}},stop:function h(){if(this.timer){f.log("stop timer");clearInterval(this.timer);this.timer=null}}}},{"./logger":7}]},{},[5])(5)});